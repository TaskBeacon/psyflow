<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="TriggerSender: Sending Hardware Triggers" href="send_trigger.html" /><link rel="prev" title="StimBank: Flexible Stimulus Management" href="build_stimulus.html" />

    <!-- Generated with Sphinx 7.3.7 and Furo 2024.08.06 -->
        <title>StimUnit: Modular Stimulus &amp; Response Handler - psyflow 0.1.2</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/logo_settings.css?v=510bd44c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">psyflow 0.1.2</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/logo_white-removebg.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/logo_black-removebg.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">psyflow 0.1.2</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-cta entries-box">
  <ul style="list-style: none; padding-left: 0;">
    <li><a href="https://taskbeacon.github.io/">Taskbeacon Home</a></li>
  </ul>
</div><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started with PsyFlow</a></li>
<li class="toctree-l1"><a class="reference internal" href="get_subinfo.html">SubInfo: Collecting Participant Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="task_settings.html">TaskSettings: Configuring Your Experiment</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_blocks.html">BlockUnit: Managing Trials</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_stimulus.html">StimBank: Flexible Stimulus Management</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">StimUnit: Modular Stimulus &amp; Response Handler</a></li>
<li class="toctree-l1"><a class="reference internal" href="send_trigger.html">TriggerSender: Sending Hardware Triggers</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_usage.html">psyflow-init: Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="utilities.html">Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="llm_client.html">LLMClient: Using Large Language Models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">中文教程(Chinese Tutorials)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started_cn.html">PsyFlow 入门指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="get_subinfo_cn.html">SubInfo: 收集被试信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="task_settings_cn.html">TaskSettings: 配置您的实验</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_blocks_cn.html">BlockUnit: 管理试验</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_stimulus_cn.html">StimBank: 灵活的刺激管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_stimunit_cn.html">StimUnit：模块化的刺激呈现与反应处理单元</a></li>
<li class="toctree-l1"><a class="reference internal" href="send_trigger_cn.html">TriggerSender: 发送硬件触发器</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_usage_cn.html">psyflow-init: 命令行界面</a></li>
<li class="toctree-l1"><a class="reference internal" href="llm_client_cn.html">LLMClient: 使用大型语言模型</a></li>
</ul>

</div></div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/TaskBeacon/psyflow/blob/main/source/tutorials/build_stimunit.md?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/TaskBeacon/psyflow/edit/main/source/tutorials/build_stimunit.md" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="stimunit-modular-stimulus-response-handler">
<h1>StimUnit: Modular Stimulus &amp; Response Handler<a class="headerlink" href="#stimunit-modular-stimulus-response-handler" title="Link to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">StimUnit</span></code> is a versatile, stimulus-level controller for PsychoPy experiments. It bundles everything you need for one trial into a single, chainable object:</p>
<ul class="simple">
<li><p><strong>Stimulus presentation</strong>: Draw multiple visual or audio stimuli together with sub-frame accuracy.</p></li>
<li><p><strong>Response collection</strong>: Detect keyboard events and record reaction times effortlessly.</p></li>
<li><p><strong>Timing control</strong>: Opt for frame-based (refresh-locked) or clock-based timing based on your needs.</p></li>
<li><p><strong>State management</strong>: Store all trial-related data in a centralized internal dictionary.</p></li>
<li><p><strong>Event hooks</strong>: Plug in custom callbacks at start, response, timeout, and end stages.</p></li>
</ul>
<p>By using <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code>, your trial logic (typically defined in <code class="docutils literal notranslate"><span class="pre">src/run_trial.py</span></code>) becomes more modular, readable, and maintainable.</p>
</section>
<section id="key-features">
<h2>Key Features<a class="headerlink" href="#key-features" title="Link to this heading">¶</a></h2>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Feature</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Chainable API</strong></p></td>
<td><p>Build trials fluently by chaining methods.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Frame-based Timing</strong></p></td>
<td><p>High precision</p></td>
</tr>
<tr class="row-even"><td><p><strong>Event hooks</strong></p></td>
<td><p>Call custom functions on start, response, timeout, or end.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Flexible responses</strong></p></td>
<td><p>Specify valid keys and automatic RT handling.</p></td>
</tr>
<tr class="row-even"><td><p><strong>State tracking</strong></p></td>
<td><p>Centralized storage of timestamps, responses, and custom data.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Response highlight</strong></p></td>
<td><p>Visually emphasize selections (static or dynamic).</p></td>
</tr>
<tr class="row-even"><td><p><strong>Jittered timing</strong></p></td>
<td><p>Support randomized (min–max) durations for unpredictability.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="quick-reference">
<h2>Quick Reference<a class="headerlink" href="#quick-reference" title="Link to this heading">¶</a></h2>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Purpose</p></th>
<th class="head"><p>Method</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Initialize</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">StimUnit(label,</span> <span class="pre">win,</span> <span class="pre">kb)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">=</span> <span class="pre">StimUnit(&quot;cue&quot;,</span> <span class="pre">win,</span> <span class="pre">kb)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Add stimuli</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.add_stim(stim1,</span> <span class="pre">stim2,</span> <span class="pre">...)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unit.add_stim(fixation,</span> <span class="pre">target)</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Start hook</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.on_start(fn)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;unit.on_start()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Response hook</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.on_response(keys,</span> <span class="pre">fn)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;unit.on_response(['left','right'])</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Timeout hook</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.on_timeout(sec,</span> <span class="pre">fn)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;unit.on_timeout(2.0)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>End hook</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.on_end(fn)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&#64;unit.on_end()</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<p>| Simple display     | <code class="docutils literal notranslate"><span class="pre">.show(duration)</span></code>                   | <code class="docutils literal notranslate"><span class="pre">unit.show(1.0)</span></code>                               |
| Response capture   | <code class="docutils literal notranslate"><span class="pre">.capture_response(keys,</span> <span class="pre">duration)</span></code> | <code class="docutils literal notranslate"><span class="pre">unit.capture_response(['left','right'],</span> <span class="pre">2.0)</span></code> |
| Full trial control | <code class="docutils literal notranslate"><span class="pre">.run()</span></code>                            | <code class="docutils literal notranslate"><span class="pre">unit.run()</span></code>                                   |
| Pause &amp; continue   | <code class="docutils literal notranslate"><span class="pre">.wait_and_continue(keys)</span></code>          | <code class="docutils literal notranslate"><span class="pre">unit.wait_and_continue(['space'])</span></code>            |
| Update state       | <code class="docutils literal notranslate"><span class="pre">.set_state(**kwargs)</span></code>              | <code class="docutils literal notranslate"><span class="pre">unit.set_state(correct=True)</span></code>                 |
| Retrieve state     | <code class="docutils literal notranslate"><span class="pre">.get_state()</span></code> or access <code class="docutils literal notranslate"><span class="pre">.state</span></code>     | <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">=</span> <span class="pre">unit.get_state(key,default)</span></code>                        |
| Export state     | <code class="docutils literal notranslate"><span class="pre">.to_dict()</span></code>      | <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">=</span> <span class="pre">unit.to_dict()</span></code>                        |</p>
</section>
<section id="detailed-usage-guide">
<h2>Detailed Usage Guide<a class="headerlink" href="#detailed-usage-guide" title="Link to this heading">¶</a></h2>
<section id="create-a-stimbank">
<h3>0. Create a StimBank<a class="headerlink" href="#create-a-stimbank" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">psyflow.stim_bank</span><span class="w"> </span><span class="kn">import</span> <span class="n">StimBank</span>
<span class="c1"># 1. Define a dictionary of stimulus configurations</span>
<span class="n">stim_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fixation&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span>
        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
        <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
    <span class="p">},</span>
    <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;circle&#39;</span><span class="p">,</span>
        <span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s1">&#39;fillColor&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span>
    <span class="p">},</span>
    <span class="s1">&#39;feedback&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;Correct!&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span>
        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># 2. Create your StimBank with window and definitions</span>
<span class="n">stim_bank</span> <span class="o">=</span> <span class="n">StimBank</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">stim_config</span><span class="p">)</span>
<span class="n">stim_bank</span><span class="o">.</span><span class="n">preload_all</span><span class="p">()</span>  <span class="c1"># optional</span>
</pre></div>
</div>
</section>
<section id="initialization">
<h3>1. Initialization<a class="headerlink" href="#initialization" title="Link to this heading">¶</a></h3>
<p>Start by creating your PsychoPy window and keyboard, then instantiate <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code> with a descriptive label.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">win</span> <span class="o">=</span> <span class="n">visual</span><span class="o">.</span><span class="n">Window</span><span class="p">([</span><span class="mi">1024</span><span class="p">,</span><span class="mi">768</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">kb</span> <span class="o">=</span> <span class="n">Keyboard</span><span class="p">()</span>

<span class="c1"># Instantiate StimUnit</span>
<span class="n">fix</span> <span class="o">=</span> <span class="n">StimUnit</span><span class="p">(</span><span class="s1">&#39;fix&#39;</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fixation&#39;</span><span class="p">))</span>
<span class="n">tar</span> <span class="o">=</span> <span class="n">StimUnit</span><span class="p">(</span><span class="s1">&#39;tar&#39;</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">))</span>
<span class="n">fb</span> <span class="o">=</span> <span class="n">StimUnit</span><span class="p">(</span><span class="s1">&#39;fb&#39;</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;feedback&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Choose descriptive <code class="docutils literal notranslate"><span class="pre">unit_label</span></code>s (e.g., <code class="docutils literal notranslate"><span class="pre">&quot;fix&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;tar&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;fb&quot;</span></code>). These labels are automatically prefixed to your state keys when you call <code class="docutils literal notranslate"><span class="pre">set_state()</span></code> and accessed by <code class="docutils literal notranslate"><span class="pre">get_state()</span></code>, ensuring your trial data is neatly namespaced and easy to query.</p>
<p><strong>Pro tip:</strong> When you need to create many similar trial units in the same context, use Python’s <code class="docutils literal notranslate"><span class="pre">functools.partial</span></code> to simplify instantiation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
<span class="c1"># Create a shortcut with common arguments</span>
<span class="n">make_unit</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">StimUnit</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="n">win</span><span class="p">,</span> <span class="n">kb</span><span class="o">=</span><span class="n">kb</span><span class="p">)</span>

<span class="c1"># --- Cue phase ---</span>
<span class="n">fix</span><span class="o">=</span><span class="n">make_unit</span><span class="p">(</span><span class="s1">&#39;fix&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fixation&#39;</span><span class="p">))</span>
<span class="n">tar</span><span class="o">=</span><span class="n">make_unit</span><span class="p">(</span><span class="s1">&#39;tar&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">))</span>
<span class="n">fb</span><span class="o">=</span><span class="n">make_unit</span><span class="p">(</span><span class="s1">&#39;fb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;feedback&#39;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="adding-stimuli">
<h3>2. Adding Stimuli<a class="headerlink" href="#adding-stimuli" title="Link to this heading">¶</a></h3>
<p>Before presenting a trial, attach the stimuli you want to display or play—this defines what participants will see or hear during the unit.</p>
<p>StimUnit accepts instances of <code class="docutils literal notranslate"><span class="pre">visual.BaseVisualStim</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">TextStim</span></code>, <code class="docutils literal notranslate"><span class="pre">Circle</span></code>) and <code class="docutils literal notranslate"><span class="pre">sound.Sound</span></code>. You can add a single stimulus, multiple stimuli at once, or pass a list of stimuli:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add a single stimulus</span>
<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fixation&#39;</span><span class="p">))</span>

<span class="c1"># Add multiple stimuli at once</span>
<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span>
    <span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">),</span>
    <span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;feedback&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Add a list of stimuli</span>
<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">([</span>
    <span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fixation&#39;</span><span class="p">),</span>
    <span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">),</span>
    <span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;feedback&#39;</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Chain additions </span>
<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fixation&#39;</span><span class="p">))</span> \
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">))</span> \
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;feedback&#39;</span><span class="p">))</span>

<span class="c1"># Clear all stimuli</span>
<span class="n">unit</span><span class="o">.</span><span class="n">clear_stimuli</span><span class="p">()</span>
</pre></div>
</div>
<p>All added stimuli will be drawn or played together when you present the unit.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">add_stim</span></code> also support PsychoPy style definitions of the stimulus. For exmaple:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">psychopy.visual</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextStim</span><span class="p">,</span> <span class="n">Circle</span>
<span class="c1"># Example 1</span>
<span class="n">stim_list</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fix&#39;</span><span class="p">:</span> <span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> 
            <span class="s1">&#39;tar&#39;</span><span class="p">:</span> <span class="n">Circle</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fillColor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">),</span>
            <span class="s1">&#39;fb&#39;</span><span class="p">:</span> <span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Correct!&#39;</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))}</span>
<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_list</span><span class="p">[</span><span class="s1">&#39;fix&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_list</span><span class="p">[</span><span class="s1">&#39;tar&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_list</span><span class="p">[</span><span class="s1">&#39;fb&#39;</span><span class="p">])</span>

<span class="c1"># Example 2</span>
<span class="n">fixation</span> <span class="o">=</span> <span class="n">visual</span><span class="o">.</span><span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">fixation</span><span class="p">)</span>
<span class="n">unit</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">psyflow</span></code> framework, stimuli are normally retrieved from a <code class="docutils literal notranslate"><span class="pre">stim_bank</span></code> object.
This lets you quickly retrieve named stimuli from your <code class="docutils literal notranslate"><span class="pre">stim_bank</span></code> and pass them into a <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code>, streamlining stimunit setup. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">condition</span> <span class="o">=</span> <span class="s1">&#39;loss&#39;</span>
<span class="n">make_unit</span><span class="p">(</span><span class="n">unit_label</span><span class="o">=</span><span class="s1">&#39;cue&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_cue&quot;</span><span class="p">))</span>
<span class="n">make_unit</span><span class="p">(</span><span class="n">unit_label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;pop&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_pop&quot;</span><span class="p">))</span>\
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pop_sound&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="display-stimulus-with-show">
<h3>3. Display stimulus with <code class="docutils literal notranslate"><span class="pre">show()</span></code><a class="headerlink" href="#display-stimulus-with-show" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">show()</span></code> method is the core display function in <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code>. It handles precise timing, drawing, optional audio playback, and state logging—all in one call. Use it when you want to present stimuli without requiring responses.</p>
<p><strong>Key Features of <code class="docutils literal notranslate"><span class="pre">show()</span></code></strong></p>
<ul class="simple">
<li><p><strong>Frame-based timing</strong>: Locks presentation to monitor refreshes for sub-frame precision.</p></li>
<li><p><strong>Automatic audio support</strong>: Starts any sound stimuli on the first flip.</p></li>
<li><p><strong>Flexible duration</strong>: Accepts fixed times, jittered ranges, or automatically uses sound length.</p></li>
<li><p><strong>State logging</strong>: Records onset/offset timestamps and duration into <code class="docutils literal notranslate"><span class="pre">unit.state</span></code>.</p></li>
</ul>
<p>Use this method when you need standalone stimulus presentation without response handling:</p>
<ul class="simple">
<li><p><strong>Feedback Displays</strong>: Show feedback messages or sounds (e.g., “Correct!”, error tones) for a short duration.</p></li>
<li><p><strong>Passive Stimulus Presentation</strong>: Present visual or auditory stimuli (e.g., flicker, tones) in paradigms where responses are recorded separately, such as resting-state EEG or fMRI.</p></li>
<li><p><strong>Baseline/Rest Periods</strong>: Present fixation crosses or blank screens for jittered durations to serve as inter-trial intervals or baselines.</p></li>
</ul>
<section id="method-signature">
<h4>Method Signature<a class="headerlink" href="#method-signature" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
    <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">onset_trigger</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">offset_trigger</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StimUnit</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">duration</span></code>:</p>
<ul>
<li><p><strong>None</strong>: Uses the longest <code class="docutils literal notranslate"><span class="pre">getDuration()</span></code> of your sound stimuli (0.0 if none).</p></li>
<li><p><strong>float</strong>: A fixed presentation time in seconds.</p></li>
<li><p><strong>(min, max)</strong>: Uniformly randomize between <code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">onset_trigger</span></code> / <code class="docutils literal notranslate"><span class="pre">offset_trigger</span></code>: <em>(optional)</em> placeholder parameters for sending triggers—these are ignored if you manage triggers separately.</p></li>
</ul>
</section>
<section id="behavior-table">
<h4>Behavior Table<a class="headerlink" href="#behavior-table" title="Link to this heading">¶</a></h4>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Input Duration</p></th>
<th class="head"><p>Behavior</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Auto-select from audio (max duration or 0.0).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0.5</span></code></p></td>
<td><p>Present for exactly 0.5 s.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">(0.8,</span> <span class="pre">1.2)</span></code></p></td>
<td><p>Sample in [0.8, 1.2] s.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">1.0</span></code> + audio of 2.5 s</p></td>
<td><p>Screen stops at 1.0 s; audio may be cut off.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">None</span></code> + audio of 2.5 s</p></td>
<td><p>Both screen &amp; audio last full 2.5 s.</p></td>
</tr>
</tbody>
</table>
</div>
<p>The following examples demonstrate how to use <code class="docutils literal notranslate"><span class="pre">.show()</span></code> for fixed, jittered, and audio-driven durations. Assume <code class="docutils literal notranslate"><span class="pre">unit</span></code> is an initialized <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code> and <code class="docutils literal notranslate"><span class="pre">stim_bank</span></code> contains your stimuli.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Fixed duration – shows text for exactly 1.0 second</span>
<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fixation&#39;</span><span class="p">))</span>\
    <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># 2. Jittered duration – shows text for a random time between 1 and 2s</span>
<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fixation&#39;</span><span class="p">))</span>\
    <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c1">#tuple</span>

<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fixation&#39;</span><span class="p">))</span>\
    <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span> <span class="c1">#list</span>

<span class="c1"># 3. Auto from audio – shows visual and plays audio for the full sound duration</span>
<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="p">[</span><span class="s1">&#39;pop_sound&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="c1"># duration=None is default</span>

<span class="c1"># 4. Multiple stimuli</span>
<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pop_sound&#39;</span><span class="p">))</span>\
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fixation&#39;</span><span class="p">))</span>\
    <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="pause-continue-with-wait-and-continue">
<h3>4. Pause &amp; Continue with <code class="docutils literal notranslate"><span class="pre">wait_and_continue()</span></code><a class="headerlink" href="#pause-continue-with-wait-and-continue" title="Link to this heading">¶</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">.wait_and_continue()</span></code> to display stimuli and wait for participant input before proceeding, ideal for instruction screens, inter-block breaks, and end-of-experiment acknowledgments. It enforces a minimum display time and can optionally terminate the session after the key press.</p>
<p>Use this method when you need participants to confirm or acknowledge before moving on, without capturing a trial response. Common scenarios include:</p>
<ul class="simple">
<li><p><strong>Instruction screens</strong>: e.g., “Press SPACE to start” before an experiment block.</p></li>
<li><p><strong>Inter-block breaks</strong>: Giving participants a chance to rest and proceed when ready.</p></li>
<li><p><strong>End-of-experiment messages</strong>: Display a thank‑you note or debrief until key press.</p></li>
<li><p><strong>Any standalone confirmation</strong>: When you don’t need to record response data but require an explicit continuation.</p></li>
</ul>
<section id="id1">
<h4>Method Signature<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">wait_and_continue</span><span class="p">(</span>
    <span class="n">keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;space&quot;</span><span class="p">],</span>
    <span class="n">min_wait</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">log_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">terminate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StimUnit</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">keys</span></code>: List of keys that allow continuation (default <code class="docutils literal notranslate"><span class="pre">['space']</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_wait</span></code>: Minimum seconds to wait before accepting input. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, and audio stimuli are present, it defaults to the longest sound duration. If only visual stimuli are present, it defaults to infinite until the button preseed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">log_message</span></code>: Custom message logged to PsychoPy’s log (defaults to:</p>
<ul>
<li><p>“Continuing after key ‘X’” or</p></li>
<li><p>“Experiment ended by key press.” if <code class="docutils literal notranslate"><span class="pre">terminate=True</span></code>).</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">terminate</span></code>: If <code class="docutils literal notranslate"><span class="pre">True</span></code>, closes the PsychoPy window after input.</p></li>
</ul>
<p><strong>Example</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instruction screen: wait at least 2s for SPACE</span>
<span class="n">StimUnit</span><span class="p">(</span><span class="s1">&#39;instruction_text&#39;</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;instruction_text&#39;</span><span class="p">))</span>\
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;instruction_text_voice&#39;</span><span class="p">))</span>\
    <span class="o">.</span><span class="n">wait_and_continue</span><span class="p">()</span>

<span class="c1"># End screen: immediate termination on key</span>
<span class="n">final_score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">trial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;feedback_delta&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">all_data</span><span class="p">)</span>
<span class="n">StimUnit</span><span class="p">(</span><span class="s1">&#39;goodbye&#39;</span><span class="p">,</span><span class="n">win</span><span class="p">,</span><span class="n">kb</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get_and_format</span><span class="p">(</span><span class="s1">&#39;good_bye&#39;</span><span class="p">,</span> <span class="n">total_score</span><span class="o">=</span><span class="n">final_score</span><span class="p">))</span>\
    <span class="o">.</span><span class="n">wait_and_continue</span><span class="p">(</span><span class="n">terminate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="get-responses-with-capture-response">
<h3>6. Get responses with <code class="docutils literal notranslate"><span class="pre">capture_response()</span></code><a class="headerlink" href="#get-responses-with-capture-response" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">capture_response()</span></code> method in <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code> integrates stimulus presentation, timing, triggers, and response handling into a single, chainable call. Like <code class="docutils literal notranslate"><span class="pre">.show()</span></code>, it automatically handles both visual and audio stimuli. It is ideal for:</p>
<ul class="simple">
<li><p>Detecting and logging subject responses within a predefined response window</p></li>
<li><p>Determining correct versus incorrect responses for performance analysis</p></li>
<li><p>Delivering immediate visual feedback by highlighting participant selections</p></li>
</ul>
<section id="features">
<h4>Features<a class="headerlink" href="#features" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Capturing and logging participant choices within precise time windows</p></li>
<li><p>Sending and receiving hardware triggers (e.g., EEG/fMRI) in sync with stimuli</p></li>
<li><p>Differentiating correct vs. incorrect responses for performance metrics</p></li>
<li><p>Providing both static and dynamic visual feedback based on key presses</p></li>
</ul>
</section>
<section id="id2">
<h4>Method Signature<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">capture_response</span><span class="p">(</span>
    <span class="n">keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">onset_trigger</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">response_trigger</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">timeout_trigger</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">terminate_on_response</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">correct_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">highlight_stim</span><span class="p">:</span> <span class="n">visual</span><span class="o">.</span><span class="n">BaseVisualStim</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">visual</span><span class="o">.</span><span class="n">BaseVisualStim</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dynamic_highlight</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StimUnit</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code>: Valid response keys.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">duration</span></code>: Response window (fixed or jittered range).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">terminate_on_response</span></code>: If <code class="docutils literal notranslate"><span class="pre">True</span></code>, stops redrawing after a valid response.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">correct_keys</span></code>: Subset of <code class="docutils literal notranslate"><span class="pre">keys</span></code> to be treated as correct responses (for state logging).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">highligt_stim</span></code>: A stim (or dict mapping keys→stim) to draw around the selected choice.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dynamic_highlight</span></code>: If <code class="docutils literal notranslate"><span class="pre">True</span></code>, highlights update on every keypress instead of just the first.</p></li>
</ul>
<p>Below is the signature and four practical scenarios illustrating its use.</p>
</section>
<section id="scenario-1-simple-anticipation-phase-detect-early-responses-without-termination">
<h4>Scenario 1: Simple Anticipation Phase (detect early responses without termination)<a class="headerlink" href="#scenario-1-simple-anticipation-phase-detect-early-responses-without-termination" title="Link to this heading">¶</a></h4>
<p>In an anticipation phase of MID task, we want to monitor for any key presses but continue presenting the fixation cross even if the participant responds early. After the window, we record whether there was an early response.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Anticipation phase ---</span>
<span class="n">anti</span> <span class="o">=</span> <span class="n">make_unit</span><span class="p">(</span><span class="n">unit_label</span><span class="o">=</span><span class="s1">&#39;anticipation&#39;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fixation&quot;</span><span class="p">))</span>
<span class="n">anti</span><span class="o">.</span><span class="n">capture_response</span><span class="p">(</span>
    <span class="n">keys</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">key_list</span><span class="p">,</span>
    <span class="n">duration</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">anticipation_duration</span><span class="p">,</span>
    <span class="n">onset_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_anti_onset&quot;</span><span class="p">],</span>
    <span class="n">terminate_on_response</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="c1"># After capture_response returns, check and store early response</span>
<span class="n">early_response</span> <span class="o">=</span> <span class="n">anti</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="s2">&quot;response&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">anti</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">early_response</span><span class="o">=</span><span class="n">early_response</span><span class="p">)</span>
<span class="n">anti</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">trial_data</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">terminate_on_response=False</span></code> ensures the fixation stays on screen for the full anticipation duration, regardless of key presses.</p></li>
<li><p>After running, <code class="docutils literal notranslate"><span class="pre">anti.get_state(&quot;response&quot;)</span></code> tells whether any key was pressed.</p></li>
</ul>
</section>
<section id="scenario-2-target-phase-with-required-response">
<h4>Scenario 2: Target Phase with Required Response<a class="headerlink" href="#scenario-2-target-phase-with-required-response" title="Link to this heading">¶</a></h4>
<p>In the target phase of the MID task, we require a response. Here we use default settings where keys in the <code class="docutils literal notranslate"><span class="pre">keys=settings.key_list</span></code> count as potential responses, and no separate <code class="docutils literal notranslate"><span class="pre">correct_keys</span></code> are defined. By default, <code class="docutils literal notranslate"><span class="pre">correct_keys=None</span></code>, so any key in <code class="docutils literal notranslate"><span class="pre">keys=settings.key_list</span></code> is counted as a correct response.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Target phase ---</span>
<span class="n">duration</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">get_duration</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">make_unit</span><span class="p">(</span><span class="n">unit_label</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_target&quot;</span><span class="p">))</span>

<span class="n">target</span><span class="o">.</span><span class="n">capture_response</span><span class="p">(</span>
    <span class="n">keys</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">key_list</span><span class="p">,</span>
    <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
    <span class="n">onset_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_target_onset&quot;</span><span class="p">],</span>
    <span class="n">response_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_key_press&quot;</span><span class="p">],</span>
    <span class="n">timeout_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_no_response&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">target</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">trial_data</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>By default, <code class="docutils literal notranslate"><span class="pre">correct_keys=None</span></code>, so any key in <code class="docutils literal notranslate"><span class="pre">keys</span></code> is logged as a response.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">response_trigger</span></code> and <code class="docutils literal notranslate"><span class="pre">timeout_trigger</span></code> send triggers for EEG/behavior marking.</p></li>
</ul>
</section>
<section id="scenario-3-detecting-correct-vs-incorrect-responses">
<h4>Scenario 3: Detecting Correct vs. Incorrect Responses<a class="headerlink" href="#scenario-3-detecting-correct-vs-incorrect-responses" title="Link to this heading">¶</a></h4>
<p>In tasks where only one key is correct (e.g., left vs. right dot detection), specify <code class="docutils literal notranslate"><span class="pre">correct_keys</span></code> to log hits vs. misses.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Determine which key is correct based on target position</span>
<span class="n">target_stim</span> <span class="o">=</span> <span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trial_info</span><span class="p">[</span><span class="s1">&#39;target_position&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_target&quot;</span><span class="p">)</span>
<span class="n">correct_key</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">left_key</span>
    <span class="k">if</span> <span class="n">trial_info</span><span class="p">[</span><span class="s1">&#39;target_position&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span>
    <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">right_key</span>
<span class="p">)</span>

<span class="n">target_unit</span> <span class="o">=</span> <span class="n">make_unit</span><span class="p">(</span><span class="n">unit_label</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">target_stim</span><span class="p">)</span>

<span class="n">target_unit</span><span class="o">.</span><span class="n">capture_response</span><span class="p">(</span>
    <span class="n">keys</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">key_list</span><span class="p">,</span>
    <span class="n">correct_keys</span><span class="o">=</span><span class="p">[</span><span class="n">correct_key</span><span class="p">],</span>
    <span class="n">duration</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">target_duration</span><span class="p">,</span>
    <span class="n">onset_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_target_onset&quot;</span><span class="p">],</span>
    <span class="n">response_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;key_press&quot;</span><span class="p">),</span>
    <span class="n">timeout_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;no_response&quot;</span><span class="p">),</span>
    <span class="n">terminate_on_response</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">target_unit</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">trial_data</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">correct_keys</span></code> filters which responses count as hits. The boolean <code class="docutils literal notranslate"><span class="pre">hit</span></code> state is set accordingly.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">terminate_on_response=True</span></code> ends the trial on the first valid key press.</p></li>
</ul>
</section>
<section id="scenario-4-highlighting-participant-choices">
<h4>Scenario 4: Highlighting Participant Choices<a class="headerlink" href="#scenario-4-highlighting-participant-choices" title="Link to this heading">¶</a></h4>
<p>To provide visual feedback, pass a dictionary of highlight stimuli to draw around the chosen option. Use <code class="docutils literal notranslate"><span class="pre">dynamic_highlight=True</span></code> to allow participants to change their selection during the window.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cue</span> <span class="o">=</span> <span class="n">make_unit</span><span class="p">(</span><span class="n">unit_label</span><span class="o">=</span><span class="s2">&quot;cue&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stimA&#39;</span><span class="p">))</span> \
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stimB&#39;</span><span class="p">))</span>

<span class="n">correct_key</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">left_key</span>  <span class="c1"># for example</span>

<span class="n">cue</span><span class="o">.</span><span class="n">capture_response</span><span class="p">(</span>
    <span class="n">keys</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">key_list</span><span class="p">,</span>
    <span class="n">correct_keys</span><span class="o">=</span><span class="p">[</span><span class="n">correct_key</span><span class="p">],</span>
    <span class="n">duration</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">cue_duration</span><span class="p">,</span>
    <span class="n">onset_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="p">[</span><span class="s1">&#39;cue_onset&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">marker_pad</span><span class="p">,</span>
    <span class="n">response_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="p">[</span><span class="s1">&#39;key_press&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">marker_pad</span><span class="p">,</span>
    <span class="n">timeout_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="p">[</span><span class="s1">&#39;no_response&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">marker_pad</span><span class="p">,</span>
    <span class="n">terminate_on_response</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">highlight_stim</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;highlight_left&#39;</span><span class="p">),</span>
        <span class="s1">&#39;j&#39;</span><span class="p">:</span> <span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;highlight_right&#39;</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">dynamic_highlight</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">cue</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">trial_data</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">highlight_stim</span></code> maps each key to a visual cue (e.g., a frame or dot).</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">dynamic_highlight=True</span></code>, each new key press updates the highlight until the window ends.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can also pass a <code class="docutils literal notranslate"><span class="pre">dict</span></code> to <code class="docutils literal notranslate"><span class="pre">response_trigger</span></code> to send different trigger codes per key.</p>
</div>
</section>
</section>
<section id="lifecycle-hooks">
<h3>7. Lifecycle Hooks<a class="headerlink" href="#lifecycle-hooks" title="Link to this heading">¶</a></h3>
<p>Lifecycle hooks give you maximum flexibility to define custom behaviors at key trial events—complementing built‑in methods like <code class="docutils literal notranslate"><span class="pre">.capture_response()</span></code> or <code class="docutils literal notranslate"><span class="pre">.show()</span></code>. You pick exactly what code runs during <strong>start</strong>, <strong>response</strong>, <strong>timeout</strong>, and <strong>end</strong> phases.</p>
<p>Below is a complete example demonstrating how each hook operates in practice. Watch how state keys are automatically prefixed with your <code class="docutils literal notranslate"><span class="pre">unit_label</span></code> (“demo”):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">psychopy</span><span class="w"> </span><span class="kn">import</span> <span class="n">core</span><span class="p">,</span> <span class="n">visual</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">psychopy.hardware.keyboard</span><span class="w"> </span><span class="kn">import</span> <span class="n">Keyboard</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">psyflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">StimUnit</span>

<span class="c1"># 1. Setup</span>
<span class="n">win</span> <span class="o">=</span> <span class="n">visual</span><span class="o">.</span><span class="n">Window</span><span class="p">([</span><span class="mi">800</span><span class="p">,</span><span class="mi">600</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
<span class="n">kb</span>  <span class="o">=</span> <span class="n">Keyboard</span><span class="p">()</span>
<span class="n">unit</span> <span class="o">=</span> <span class="n">StimUnit</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span>

<span class="c1"># 2. Add a stimulus</span>
<span class="n">fix</span> <span class="o">=</span> <span class="n">visual</span><span class="o">.</span><span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">fix</span><span class="p">)</span>

<span class="c1"># 3. Define hooks</span>
<span class="nd">@unit</span><span class="o">.</span><span class="n">on_start</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">start_hook</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="c1"># record the moment the trial begins</span>
    <span class="n">u</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">start_time</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[start_hook] prefix key &#39;demo_start_time&#39; = </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;demo_start_time&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nd">@unit</span><span class="o">.</span><span class="n">on_response</span><span class="p">([</span><span class="s1">&#39;space&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">response_hook</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">rt</span><span class="p">):</span>
    <span class="c1"># capture spacebar presses</span>
    <span class="n">u</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">rt</span><span class="o">=</span><span class="n">rt</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[response_hook] key=</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">, rt=</span><span class="si">{</span><span class="n">rt</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nd">@unit</span><span class="o">.</span><span class="n">on_timeout</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">timeout_hook</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="c1"># handle no-response after 1 second</span>
    <span class="n">u</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[timeout_hook] no response within 1.0s&quot;</span><span class="p">)</span>

<span class="nd">@unit</span><span class="o">.</span><span class="n">on_end</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">end_hook</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="c1"># finalize and inspect full state</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[end_hook] final state:&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="c1"># 4. Run the trial</span>
<span class="n">unit</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Explanation:</strong></p>
<ul class="simple">
<li><p><strong>start_hook</strong>: Fires immediately after the global start time is recorded and before the first screen flip.</p></li>
<li><p><strong>response_hook</strong>: Executes on <code class="docutils literal notranslate"><span class="pre">'space'</span></code> press, providing <code class="docutils literal notranslate"><span class="pre">(unit,</span> <span class="pre">key,</span> <span class="pre">rt)</span></code>.</p></li>
<li><p><strong>timeout_hook</strong>: Triggers if no response occurs within 1.0 second.</p></li>
<li><p><strong>end_hook</strong>: Runs after the trial finishes but before logging, giving you a final chance to inspect or modify data.</p></li>
</ul>
<p>All calls to <code class="docutils literal notranslate"><span class="pre">u.set_state()</span></code> automatically add entries like <code class="docutils literal notranslate"><span class="pre">demo_start_time</span></code>, <code class="docutils literal notranslate"><span class="pre">demo_response</span></code>, and <code class="docutils literal notranslate"><span class="pre">demo_timeout</span></code> into <code class="docutils literal notranslate"><span class="pre">unit.state</span></code>, which you can retrieve with <code class="docutils literal notranslate"><span class="pre">unit.to_dict()</span></code> or view in your PsychoPy logs via <code class="docutils literal notranslate"><span class="pre">unit.log_unit()</span></code>.</p>
<p>Instead of decorators, you can register hooks fluently via chaining for concise code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unit</span> <span class="o">=</span> <span class="n">StimUnit</span><span class="p">(</span><span class="s1">&#39;chain_demo&#39;</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span>  

<span class="c1"># Chain registrations and run in one statement</span>
<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">fix</span><span class="p">)</span>  
    <span class="o">.</span><span class="n">on_start</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>  
    <span class="o">.</span><span class="n">on_response</span><span class="p">([</span><span class="s1">&#39;space&#39;</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">rt</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">rt</span><span class="o">=</span><span class="n">rt</span><span class="p">))</span>  
    <span class="o">.</span><span class="n">on_timeout</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>  
    <span class="o">.</span><span class="n">on_end</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Chained final state:&#39;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()))</span>  
    <span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>While <code class="docutils literal notranslate"><span class="pre">.show()</span></code> and <code class="docutils literal notranslate"><span class="pre">.capture_response()</span></code> bundle common patterns, you can achieve the same behavior using lifecycle hooks for greater customization.</p>
<section id="replicating-show-with-hooks">
<h4>Replicating <code class="docutils literal notranslate"><span class="pre">show()</span></code> with Hooks<a class="headerlink" href="#replicating-show-with-hooks" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">unit</span> <span class="o">=</span> <span class="n">StimUnit</span><span class="p">(</span><span class="s1">&#39;show_demo&#39;</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span>
<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">my_stim</span><span class="p">)</span>

<span class="c1"># Start: send onset trigger, record time</span>
<span class="nd">@unit</span><span class="o">.</span><span class="n">on_start</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">start_show</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="n">u</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">callOnFlip</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">send_trigger</span><span class="p">,</span> <span class="n">trigger_onset</span><span class="p">)</span>
    <span class="n">u</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">onset_time</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">())</span>

<span class="c1"># Timeout after desired duration: send offset trigger, record close time</span>
<span class="nd">@unit</span><span class="o">.</span><span class="n">on_timeout</span><span class="p">(</span><span class="n">show_duration</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">end_show</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="n">u</span><span class="o">.</span><span class="n">send_trigger</span><span class="p">(</span><span class="n">trigger_offset</span><span class="p">)</span>
    <span class="n">u</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">close_time</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">())</span>

<span class="c1"># End hook for any cleanup or logging</span>
<span class="nd">@unit</span><span class="o">.</span><span class="n">on_end</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">finalize_show</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Show ended, state:&#39;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">get_dict</span><span class="p">())</span>

<span class="c1"># Run without terminating on response (no responses listened for)</span>
<span class="n">unit</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">terminate_on_response</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>on_start sets up the flip‑synchronized onset trigger and timestamps.</p></li>
<li><p>on_timeout fires after show_duration, mirroring offset_trigger.</p></li>
<li><p>on_end finalizes the trial.</p></li>
</ul>
<p>For a more fluent style, you can register hooks and configure trials in a chainable manner:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">make_unit</span><span class="p">(</span><span class="s1">&#39;show_chain&#39;</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">my_stim</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">on_start</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="p">(</span>
        <span class="n">u</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">callOnFlip</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">send_trigger</span><span class="p">,</span> <span class="n">trigger_onset</span><span class="p">),</span>
        <span class="n">u</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">onset_time</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">())</span>
    <span class="p">))</span> \
    <span class="o">.</span><span class="n">on_timeout</span><span class="p">(</span><span class="n">show_duration</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="p">(</span>
        <span class="n">u</span><span class="o">.</span><span class="n">send_trigger</span><span class="p">(</span><span class="n">trigger_offset</span><span class="p">),</span>
        <span class="n">u</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">close_time</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">())</span>
    <span class="p">))</span> \
    <span class="o">.</span><span class="n">on_end</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Show ended, state:&#39;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">get_dict</span><span class="p">()))</span> \
    <span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">terminate_on_response</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="replicating-capture-response-with-hooks">
<h4>Replicating <code class="docutils literal notranslate"><span class="pre">.capture_response()</span></code> with Hooks<a class="headerlink" href="#replicating-capture-response-with-hooks" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">unit</span> <span class="o">=</span> <span class="n">StimUnit</span><span class="p">(</span><span class="s1">&#39;resp_demo&#39;</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span>
<span class="n">unit</span><span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">response_stim</span><span class="p">)</span>

<span class="c1"># Start: draw stimuli, flip, send onset trigger, reset clock</span>
<span class="nd">@unit</span><span class="o">.</span><span class="n">on_start</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">start_resp</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">stimuli</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="n">u</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">callOnFlip</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">send_trigger</span><span class="p">,</span> <span class="n">onset_trigger</span><span class="p">)</span>
    <span class="n">u</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">callOnFlip</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">reset</span><span class="p">)</span>

<span class="c1"># Response: for each valid key, send trigger and set state</span>
<span class="nd">@unit</span><span class="o">.</span><span class="n">on_response</span><span class="p">([</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">on_resp</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">rt</span><span class="p">):</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">response_triggers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">u</span><span class="o">.</span><span class="n">send_trigger</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="n">u</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">rt</span><span class="o">=</span><span class="n">rt</span><span class="p">,</span> <span class="n">hit</span><span class="o">=</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">correct_keys</span><span class="p">))</span>

<span class="c1"># Timeout: if no response within window</span>
<span class="nd">@unit</span><span class="o">.</span><span class="n">on_timeout</span><span class="p">(</span><span class="n">response_duration</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">on_timeout</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="n">u</span><span class="o">.</span><span class="n">send_trigger</span><span class="p">(</span><span class="n">timeout_trigger</span><span class="p">)</span>
    <span class="n">u</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># End: log and clean up</span>
<span class="nd">@unit</span><span class="o">.</span><span class="n">on_end</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">end_resp</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="n">u</span><span class="o">.</span><span class="n">log_unit</span><span class="p">()</span>

<span class="c1"># Run the trial (hooks manage drawing and events)</span>
<span class="n">unit</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Make it in a chainable manner:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">make_unit</span><span class="p">(</span><span class="s1">&#39;resp_chain&#39;</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">response_stim</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">on_start</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">stimuli</span><span class="p">],</span>
        <span class="n">u</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">callOnFlip</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">send_trigger</span><span class="p">,</span> <span class="n">onset_trigger</span><span class="p">),</span>
        <span class="n">u</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">callOnFlip</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">reset</span><span class="p">)</span>
    <span class="p">))</span> \
    <span class="o">.</span><span class="n">on_response</span><span class="p">([</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">rt</span><span class="p">:</span> <span class="p">(</span>
        <span class="n">u</span><span class="o">.</span><span class="n">send_trigger</span><span class="p">(</span><span class="n">response_triggers</span><span class="p">[</span><span class="n">key</span><span class="p">]),</span>
        <span class="n">u</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">rt</span><span class="o">=</span><span class="n">rt</span><span class="p">,</span> <span class="n">hit</span><span class="o">=</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">correct_keys</span><span class="p">))</span>
    <span class="p">))</span> \
    <span class="o">.</span><span class="n">on_timeout</span><span class="p">(</span><span class="n">response_duration</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="p">(</span>
        <span class="n">u</span><span class="o">.</span><span class="n">send_trigger</span><span class="p">(</span><span class="n">timeout_trigger</span><span class="p">),</span>
        <span class="n">u</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">))</span> \
    <span class="o">.</span><span class="n">on_end</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">log_unit</span><span class="p">())</span> \
    <span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In most cases, using <code class="docutils literal notranslate"><span class="pre">.show()</span></code>, <code class="docutils literal notranslate"><span class="pre">.capture_response()</span></code>, and <code class="docutils literal notranslate"><span class="pre">.wait_and_continue()</span></code> covers the vast majority of task requirements and has been extensively tested. Lifecycle hooks offer maximum flexibility, but they are less commonly used and have seen less practical validation. We did not test their usage extensively. Only opt for manual hooks when you need custom behavior beyond the built-in methods—and proceed with caution.</p>
</div>
</section>
</section>
<section id="state-and-data-management">
<h3>8. State and Data Management<a class="headerlink" href="#state-and-data-management" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">StimUnit</span></code> keeps all unit-related values in its internal <code class="docutils literal notranslate"><span class="pre">unit.state</span></code> dictionary. Use the following methods to keep your StimUnit data organized, easily retrievable, and ready for analysis or export.</p>
<section id="recording-or-updating-values-with-set-state">
<h4>Recording or Updating Values with <code class="docutils literal notranslate"><span class="pre">set_state()</span></code><a class="headerlink" href="#recording-or-updating-values-with-set-state" title="Link to this heading">¶</a></h4>
<p>Use <code class="docutils literal notranslate"><span class="pre">set_state()</span></code> to record key–value data into the unit’s state</p>
<p><strong>Example</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># --- Feedback ---</span>
<span class="k">if</span> <span class="n">early_response</span><span class="p">:</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">delta</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">hit</span><span class="o">=</span><span class="kc">False</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">hit</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="s2">&quot;hit&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">condition</span> <span class="o">==</span> <span class="s2">&quot;win&quot;</span><span class="p">:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">delta</span> <span class="k">if</span> <span class="n">hit</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">condition</span> <span class="o">==</span> <span class="s2">&quot;lose&quot;</span><span class="p">:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">hit</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">delta</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">hit_type</span> <span class="o">=</span> <span class="s2">&quot;hit&quot;</span> <span class="k">if</span> <span class="n">hit</span> <span class="k">else</span> <span class="s2">&quot;miss&quot;</span>
<span class="n">fb_stim</span> <span class="o">=</span> <span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hit_type</span><span class="si">}</span><span class="s2">_feedback&quot;</span><span class="p">)</span>
<span class="n">fb</span> <span class="o">=</span> <span class="n">make_unit</span><span class="p">(</span><span class="n">unit_label</span><span class="o">=</span><span class="s2">&quot;feedback&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">fb_stim</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">feedback_duration</span><span class="p">,</span> <span class="n">onset_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hit_type</span><span class="si">}</span><span class="s2">_fb_onset&quot;</span><span class="p">))</span>
<span class="n">fb</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">hit</span><span class="o">=</span><span class="n">hit</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">trial_data</span><span class="p">)</span>
</pre></div>
</div>
<p>In this snippet, we:</p>
<ol class="arabic simple">
<li><p><strong>Create and display</strong> a feedback <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code> labeled “feedback” with the correct stimulus and triggers.</p></li>
<li><p><strong>Compute</strong> whether the trial was a hit (<code class="docutils literal notranslate"><span class="pre">True</span></code>/<code class="docutils literal notranslate"><span class="pre">False</span></code>) and determine the <code class="docutils literal notranslate"><span class="pre">delta</span></code> value (+Δ, –Δ, or 0).</p></li>
<li><p><strong>Record</strong> these values into the unit’s internal state using <code class="docutils literal notranslate"><span class="pre">set_state()</span></code> (which prefixes keys by default).</p></li>
<li><p><strong>Export</strong> all stored state entries into your <code class="docutils literal notranslate"><span class="pre">trial_data</span></code> dict for logging or further analysis.</p></li>
</ol>
<p>Note: <code class="docutils literal notranslate"><span class="pre">set_sate()</span></code> uses <strong>prefixing</strong> to control how keys are stored</p>
<p><strong>Default</strong> (unit label): keys stored as <code class="docutils literal notranslate"><span class="pre">&lt;unit_label&gt;_&lt;key&gt;</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fb</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">hit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1"># stores &#39;feedback_hit&#39; and &#39;feedback_delta&#39;</span>
</pre></div>
</div>
<p><strong>Raw</strong> (<code class="docutils literal notranslate"><span class="pre">prefix=''</span></code>): keys stored as-is</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fb</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">hit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1"># stores &#39;hit&#39; and &#39;delta&#39;</span>
</pre></div>
</div>
<p><strong>Custom</strong> (<code class="docutils literal notranslate"><span class="pre">prefix='special'</span></code>): keys prefixed with ‘special_’</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fb</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;special&#39;</span><span class="p">,</span> <span class="n">hit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># stores &#39;special_hit&#39;</span>
</pre></div>
</div>
<p><strong>Summary of the prefix behavior</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Mode</p></th>
<th class="head"><p>Prefix</p></th>
<th class="head"><p>Stored keys</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Default</p></td>
<td><p>(unit label)</p></td>
<td><p>feedback_hit, feedback_delta</p></td>
</tr>
<tr class="row-odd"><td><p>Raw</p></td>
<td><p>‘’</p></td>
<td><p>hit, delta</p></td>
</tr>
<tr class="row-even"><td><p>Custom</p></td>
<td><p>‘special’</p></td>
<td><p>special_hit</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code class="docutils literal notranslate"><span class="pre">set_state</span></code> is <strong>Chaining</strong>: it returns the same <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code>, so you can chain calls:<code class="docutils literal notranslate"><span class="pre">unit.set_state(block=2,</span> <span class="pre">trial=5).set_state(condition='win')</span></code></p>
</div>
<p><strong>Summary of Automatic State Entries</strong></p>
<p>Several <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code> methods populate internal state without explicit <code class="docutils literal notranslate"><span class="pre">set_state()</span></code> calls. Here’s a quick reference:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Keys Set in <code class="docutils literal notranslate"><span class="pre">.state</span></code></p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">run()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">global_time</span></code></p></td>
<td><p>Experiment-wide timestamp before start</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">onset_time</span></code>, <code class="docutils literal notranslate"><span class="pre">onset_time_global</span></code>, <code class="docutils literal notranslate"><span class="pre">flip_time</span></code></p></td>
<td><p>Recorded at first <code class="docutils literal notranslate"><span class="pre">win.flip()</span></code></p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">close_time</span></code>, <code class="docutils literal notranslate"><span class="pre">close_time_global</span></code></p></td>
<td><p>At end of trial (response or timeout)</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">timeout_triggered</span></code>, <code class="docutils literal notranslate"><span class="pre">duration</span></code></p></td>
<td><p>If a timeout occurs</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">show()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">duration</span></code></p></td>
<td><p>Final chosen duration</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">onset_time</span></code>, <code class="docutils literal notranslate"><span class="pre">onset_time_global</span></code>, <code class="docutils literal notranslate"><span class="pre">onset_trigger</span></code></p></td>
<td><p>At stimulus onset</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">flip_time</span></code></p></td>
<td><p>Time of flip after onset</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">close_time</span></code>, <code class="docutils literal notranslate"><span class="pre">close_time_global</span></code>, <code class="docutils literal notranslate"><span class="pre">offset_trigger</span></code></p></td>
<td><p>At presentation end</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">capture_response()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">duration</span></code>, <code class="docutils literal notranslate"><span class="pre">onset_time</span></code>, <code class="docutils literal notranslate"><span class="pre">onset_time_global</span></code>, <code class="docutils literal notranslate"><span class="pre">flip_time</span></code></p></td>
<td><p>Response window setup</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">hit</span></code>, <code class="docutils literal notranslate"><span class="pre">correct_keys</span></code>, <code class="docutils literal notranslate"><span class="pre">response</span></code>, <code class="docutils literal notranslate"><span class="pre">key_press</span></code>, <code class="docutils literal notranslate"><span class="pre">rt</span></code></p></td>
<td><p>On response</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">response_trigger</span></code>, <code class="docutils literal notranslate"><span class="pre">close_time</span></code>, <code class="docutils literal notranslate"><span class="pre">close_time_global</span></code></p></td>
<td><p>Response trigger and end time</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">timeout_trigger</span></code>, <code class="docutils literal notranslate"><span class="pre">hit=False</span></code>, <code class="docutils literal notranslate"><span class="pre">response=None</span></code>, <code class="docutils literal notranslate"><span class="pre">rt=None</span></code></p></td>
<td><p>On timeout</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">wait_and_continue()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">wait_keys</span></code>, <code class="docutils literal notranslate"><span class="pre">onset_time</span></code>, <code class="docutils literal notranslate"><span class="pre">onset_time_global</span></code>, <code class="docutils literal notranslate"><span class="pre">flip_time</span></code></p></td>
<td><p>At display onset</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">response</span></code>, <code class="docutils literal notranslate"><span class="pre">response_time</span></code>, <code class="docutils literal notranslate"><span class="pre">close_time</span></code>, <code class="docutils literal notranslate"><span class="pre">close_time_global</span></code></p></td>
<td><p>When continuation key pressed</p></td>
</tr>
</tbody>
</table>
</div>
<p>Use this table to quickly see what state values are filled in automatically, so you know which additional <code class="docutils literal notranslate"><span class="pre">set_state()</span></code> calls you might still need.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For <code class="docutils literal notranslate"><span class="pre">capture_response()</span></code>, the <code class="docutils literal notranslate"><span class="pre">hit</span></code> means the response was a correct key press.</p>
</div>
</section>
<section id="retrieving-values-with-get-state">
<h4>Retrieving Values with <code class="docutils literal notranslate"><span class="pre">get_state()</span></code><a class="headerlink" href="#retrieving-values-with-get-state" title="Link to this heading">¶</a></h4>
<p>When you call <code class="docutils literal notranslate"><span class="pre">get_state()</span></code>, it first looks for the exact key, then for the prefixed form (using your unit_label or a supplied prefix), and if neither is found it returns the default value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reads either &#39;response&#39; or &#39;cue_response&#39; if the unit_label is &#39;cue&#39;</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="c1"># Force a different prefix lookup, it reads &#39;custom_response&#39;</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;custom&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="exporting-all-state-with-to-dict">
<h4>Exporting All State with <code class="docutils literal notranslate"><span class="pre">.to_dict()</span></code><a class="headerlink" href="#exporting-all-state-with-to-dict" title="Link to this heading">¶</a></h4>
<p><strong><code class="docutils literal notranslate"><span class="pre">to_dict(target=None)</span></code></strong></p>
<ul class="simple">
<li><p>If no <code class="docutils literal notranslate"><span class="pre">target</span></code> is given, returns the <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code> instance (for chaining) and leaves you to inspect <code class="docutils literal notranslate"><span class="pre">unit.state</span></code>.</p></li>
<li><p>If you pass in a dict, it merges <code class="docutils literal notranslate"><span class="pre">unit.state</span></code> into that dict and returns the <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code>.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="c1"># After an anticipation phase:</span>
  <span class="n">anti</span> <span class="o">=</span> <span class="n">make_unit</span><span class="p">(</span><span class="s1">&#39;anticipation&#39;</span><span class="p">)</span>\
      <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fixation&#39;</span><span class="p">))</span>\
      <span class="o">.</span><span class="n">capture_response</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">keys</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">anticipation_duration</span><span class="p">)</span>
  <span class="c1"># Check if participant responded early</span>
  <span class="n">early</span> <span class="o">=</span> <span class="n">anti</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
  <span class="c1"># Record this custom flag and merge into main trial_data</span>
  <span class="n">anti</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">early_response</span><span class="o">=</span><span class="n">early</span><span class="p">)</span>\
      <span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">trial_data</span><span class="p">)</span>

  <span class="c1"># In the target phase:</span>
  <span class="n">target</span> <span class="o">=</span> <span class="n">make_unit</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">)</span>\
      <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_target&quot;</span><span class="p">))</span>\
      <span class="o">.</span><span class="n">capture_response</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">keys</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
  <span class="c1"># Export results</span>
  <span class="n">target</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">trial_data</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="logging-state-internally-with-log-unit">
<h4>Logging State Internally with <code class="docutils literal notranslate"><span class="pre">.log_unit()</span></code><a class="headerlink" href="#logging-state-internally-with-log-unit" title="Link to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">log_unit()</span></code> writes every key–value pair in <code class="docutils literal notranslate"><span class="pre">unit.state</span></code> to the log score in <code class="docutils literal notranslate"><span class="pre">data/*.log</span></code>.   It uses PsychoPy’s <code class="docutils literal notranslate"><span class="pre">logging.data()</span></code>, which by default appends timestamped entries to the experiment log file or console.
It’s automatically invoked within the <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code> class, so you usually don’t need to call it manually.</p>
<p><strong>What gets logged?</strong>  All entries currently in <code class="docutils literal notranslate"><span class="pre">unit.state</span></code>, including:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>State key examples</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">trial_block</span></code>, <code class="docutils literal notranslate"><span class="pre">trial_trial</span></code></p></td>
<td><p>Pre-trial identifiers</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">onset_time</span></code>, <code class="docutils literal notranslate"><span class="pre">flip_time</span></code></p></td>
<td><p>Timestamps from <code class="docutils literal notranslate"><span class="pre">.show()</span></code> or <code class="docutils literal notranslate"><span class="pre">.run()</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hit</span></code>, <code class="docutils literal notranslate"><span class="pre">response</span></code>, <code class="docutils literal notranslate"><span class="pre">rt</span></code></p></td>
<td><p>Response metrics from <code class="docutils literal notranslate"><span class="pre">capture_response()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">feedback_hit</span></code>, <code class="docutils literal notranslate"><span class="pre">feedback_delta</span></code></p></td>
<td><p>Custom values from your <code class="docutils literal notranslate"><span class="pre">set_state()</span></code> calls</p></td>
</tr>
</tbody>
</table>
</div>
<p>If you need a separate log for debugging at other points, you can call <code class="docutils literal notranslate"><span class="pre">unit.log_unit()</span></code> manually to snapshot current state.</p>
</section>
</section>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">¶</a></h2>
<p>Now that you understand how to use <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code>, you can:</p>
<ul class="simple">
<li><p><strong>Organize Blocks</strong>: Explore the <a class="reference internal" href="build_blocks.html"><span class="std std-doc">BlockUnit tutorial</span></a> to organize trials into blocks</p></li>
<li><p><strong>Manage Stimuli</strong>: Learn about <a class="reference internal" href="build_stimulus.html"><span class="std std-doc">StimBank</span></a> for flexible stimulus management</p></li>
<li><p><strong>Send Triggers</strong>: Check out <a class="reference internal" href="send_trigger.html"><span class="std std-doc">trigger sending</span></a> for EEG/MEG experiments</p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="send_trigger.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">TriggerSender: Sending Hardware Triggers</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="build_stimulus.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">StimBank: Flexible Stimulus Management</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Zhipeng Cao
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">StimUnit: Modular Stimulus &amp; Response Handler</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#key-features">Key Features</a></li>
<li><a class="reference internal" href="#quick-reference">Quick Reference</a></li>
<li><a class="reference internal" href="#detailed-usage-guide">Detailed Usage Guide</a><ul>
<li><a class="reference internal" href="#create-a-stimbank">0. Create a StimBank</a></li>
<li><a class="reference internal" href="#initialization">1. Initialization</a></li>
<li><a class="reference internal" href="#adding-stimuli">2. Adding Stimuli</a></li>
<li><a class="reference internal" href="#display-stimulus-with-show">3. Display stimulus with <code class="docutils literal notranslate"><span class="pre">show()</span></code></a><ul>
<li><a class="reference internal" href="#method-signature">Method Signature</a></li>
<li><a class="reference internal" href="#behavior-table">Behavior Table</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pause-continue-with-wait-and-continue">4. Pause &amp; Continue with <code class="docutils literal notranslate"><span class="pre">wait_and_continue()</span></code></a><ul>
<li><a class="reference internal" href="#id1">Method Signature</a></li>
</ul>
</li>
<li><a class="reference internal" href="#get-responses-with-capture-response">6. Get responses with <code class="docutils literal notranslate"><span class="pre">capture_response()</span></code></a><ul>
<li><a class="reference internal" href="#features">Features</a></li>
<li><a class="reference internal" href="#id2">Method Signature</a></li>
<li><a class="reference internal" href="#scenario-1-simple-anticipation-phase-detect-early-responses-without-termination">Scenario 1: Simple Anticipation Phase (detect early responses without termination)</a></li>
<li><a class="reference internal" href="#scenario-2-target-phase-with-required-response">Scenario 2: Target Phase with Required Response</a></li>
<li><a class="reference internal" href="#scenario-3-detecting-correct-vs-incorrect-responses">Scenario 3: Detecting Correct vs. Incorrect Responses</a></li>
<li><a class="reference internal" href="#scenario-4-highlighting-participant-choices">Scenario 4: Highlighting Participant Choices</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lifecycle-hooks">7. Lifecycle Hooks</a><ul>
<li><a class="reference internal" href="#replicating-show-with-hooks">Replicating <code class="docutils literal notranslate"><span class="pre">show()</span></code> with Hooks</a></li>
<li><a class="reference internal" href="#replicating-capture-response-with-hooks">Replicating <code class="docutils literal notranslate"><span class="pre">.capture_response()</span></code> with Hooks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#state-and-data-management">8. State and Data Management</a><ul>
<li><a class="reference internal" href="#recording-or-updating-values-with-set-state">Recording or Updating Values with <code class="docutils literal notranslate"><span class="pre">set_state()</span></code></a></li>
<li><a class="reference internal" href="#retrieving-values-with-get-state">Retrieving Values with <code class="docutils literal notranslate"><span class="pre">get_state()</span></code></a></li>
<li><a class="reference internal" href="#exporting-all-state-with-to-dict">Exporting All State with <code class="docutils literal notranslate"><span class="pre">.to_dict()</span></code></a></li>
<li><a class="reference internal" href="#logging-state-internally-with-log-unit">Logging State Internally with <code class="docutils literal notranslate"><span class="pre">.log_unit()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=92734c54"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>