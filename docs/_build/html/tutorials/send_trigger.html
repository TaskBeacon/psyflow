<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="psyflow-init: Command-Line Interface" href="cli_usage.html" /><link rel="prev" title="StimUnit: Modular Stimulus &amp; Response Handler" href="build_stimunit.html" />

    <!-- Generated with Sphinx 7.3.7 and Furo 2024.08.06 -->
        <title>TriggerSender: Sending Hardware Triggers - psyflow 0.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/logo_settings.css?v=510bd44c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">psyflow 0.1.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/logo_white-removebg.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/logo_black-removebg.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">psyflow 0.1.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started with PsyFlow</a></li>
<li class="toctree-l1"><a class="reference internal" href="get_subinfo.html">SubInfo: Collecting Participant Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="task_settings.html">TaskSettings: Configuring Your Experiment</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_blocks.html">BlockUnit: Managing Trials</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_stimulus.html">StimBank: Flexible Stimulus Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_stimunit.html">StimUnit: Modular Stimulus &amp; Response Handler</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">TriggerSender: Sending Hardware Triggers</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_usage.html">psyflow-init: Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="utilities.html">Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="llm_client.html">LLMClient: Using Large Language Models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">中文教程(Chinese Tutorials)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started_cn.html">PsyFlow 入门指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="get_subinfo_cn.html">SubInfo: 收集被试信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="task_settings_cn.html">TaskSettings: 管理实验配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_blocks_cn.html">BlockUnit: 组织和运行试验</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_stimulus_cn.html">StimBank：灵活的刺激管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_stimunit_cn.html">StimUnit：模块化的刺激呈现与反应处理单元</a></li>
<li class="toctree-l1"><a class="reference internal" href="send_trigger_cn.html">TriggerSender: 发送硬件触发器</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_usage_cn.html">psyflow-init: 命令行界面</a></li>
<li class="toctree-l1"><a class="reference internal" href="llm_client_cn.html">LLMClient: 使用大型语言模型</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/tutorials/send_trigger.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="triggersender-sending-hardware-triggers">
<h1>TriggerSender: Sending Hardware Triggers<a class="headerlink" href="#triggersender-sending-hardware-triggers" title="Link to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">TriggerSender</span></code> class provides a flexible, device-independent way to send event codes (triggers) to external recording equipment (e.g., EEG, MEG, eye‐trackers). By wrapping your device-specific send function, it keeps experiment code clean, adds optional pre- and post-hooks, enforces precise timing delays, and even supports a mock mode for development without hardware.</p>
<p><code class="docutils literal notranslate"><span class="pre">TriggerSender</span></code> solves several common challenges in neuroscience experiments:</p>
<ul class="simple">
<li><p><strong>Hardware abstraction</strong>: Decouple your experiment logic from device-specific I/O.</p></li>
<li><p><strong>Mock testing</strong>: Develop and debug on any machine—no data acquisition hardware needed.</p></li>
<li><p><strong>Precise timing</strong>: Automatically insert configurable delays after each trigger send.</p></li>
<li><p><strong>Custom hooks</strong>: Run user-provided callbacks immediately before and after each trigger.</p></li>
<li><p><strong>Robust logging</strong>: Warn on invalid codes, catch errors, and record trigger events in PsychoPy’s log.</p></li>
</ul>
</section>
<section id="key-features">
<h2>Key Features<a class="headerlink" href="#key-features" title="Link to this heading">¶</a></h2>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Feature</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Device-independent</p></td>
<td><p>Accepts any Python function to transmit integer codes to your device</p></td>
</tr>
<tr class="row-odd"><td><p>Mock mode</p></td>
<td><p>Print trigger codes instead of sending, for development/testing</p></td>
</tr>
<tr class="row-even"><td><p>Configurable delay</p></td>
<td><p>Wait a specified duration after each send (default 0.001 s)</p></td>
</tr>
<tr class="row-odd"><td><p>Pre-/post hooks</p></td>
<td><p>Execute user functions before and/or after sending each trigger</p></td>
</tr>
<tr class="row-even"><td><p>Error handling</p></td>
<td><p>Catch exceptions, log errors, and continue without crashing</p></td>
</tr>
<tr class="row-odd"><td><p>Logging support</p></td>
<td><p>Record warnings and trigger events via PsychoPy’s logging system</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="quick-reference">
<h2>Quick Reference<a class="headerlink" href="#quick-reference" title="Link to this heading">¶</a></h2>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Purpose</p></th>
<th class="head"><p>Method</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Initialize in mock mode</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TriggerSender(mock=True)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sender</span> <span class="pre">=</span> <span class="pre">TriggerSender(mock=True)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Initialize for hardware</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TriggerSender(trigger_func=your_send_function)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sender</span> <span class="pre">=</span> <span class="pre">TriggerSender(trigger_func=send_code)</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Send a trigger</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sender.send(code)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sender.send(32)</span></code></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="detailed-usage-guide">
<h2>Detailed Usage Guide<a class="headerlink" href="#detailed-usage-guide" title="Link to this heading">¶</a></h2>
<section id="getting-started-mock-mode-for-development">
<h3>1. Getting Started: Mock Mode for Development<a class="headerlink" href="#getting-started-mock-mode-for-development" title="Link to this heading">¶</a></h3>
<p>Use mock mode to build and test your experiment logic without any hardware:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">psyflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">TriggerSender</span>

<span class="c1"># Initialize in mock mode</span>
<span class="n">trigger_sender</span> <span class="o">=</span> <span class="n">TriggerSender</span><span class="p">(</span><span class="n">mock</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Console output: &quot;[MockTrigger] Sent code: 1&quot;</span>
<span class="n">trigger_sender</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Console output: &quot;[MockTrigger] Sent code: 255&quot;</span>
<span class="n">trigger_sender</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="connecting-to-real-hardware">
<h3>2. Connecting to Real Hardware<a class="headerlink" href="#connecting-to-real-hardware" title="Link to this heading">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Of the examples below, only the Serial (UART) Port example has been tested by the authors. The EGI, Neuroscan, Brain Products (RDA) and other device snippets were gathered from online sources and have not been validated on actual hardware. If you test these or implement triggers for additional devices (e.g., eye‑trackers), please share your code so we can keep this documentation up to date.</p>
</div>
<p>When your rig is ready, supply a function to send integer codes to your device via the <code class="docutils literal notranslate"><span class="pre">trigger_func</span></code> argument. You can adapt this pattern for serial ports, USB interfaces, LabJack devices, or any other hardware: just supply a function that takes an integer and transmits it.</p>
<section id="example-serial-uart-port-tested">
<h4>Example: Serial (UART) Port (tested)<a class="headerlink" href="#example-serial-uart-port-tested" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">psyflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">TriggerSender</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">serial</span>
<span class="c1">#ser = serial.serial_for_url(&quot;loop://&quot;, baudrate=115200, timeout=1)</span>
<span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s2">&quot;COM3&quot;</span><span class="p">,</span> <span class="n">baudrate</span><span class="o">=</span><span class="mi">115200</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">ser</span><span class="o">.</span><span class="n">is_open</span><span class="p">:</span>
    <span class="n">ser</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

<span class="c1"># Create TriggerSender</span>
<span class="n">trigger_sender</span> <span class="o">=</span> <span class="n">TriggerSender</span><span class="p">(</span>
    <span class="n">trigger_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">code</span><span class="p">])),</span>
    <span class="n">post_delay</span><span class="o">=</span><span class="mf">0.005</span>
<span class="p">)</span>

<span class="c1"># Example usage with psyflow BlockUnit callbacks</span>

<span class="n">trigger_sender</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exp_onset&quot;</span><span class="p">))</span>

<span class="n">block</span> <span class="o">=</span> <span class="n">BlockUnit</span><span class="p">(</span>
    <span class="n">block_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;block_</span><span class="si">{</span><span class="n">block_i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">block_idx</span><span class="o">=</span><span class="n">block_i</span><span class="p">,</span>
    <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
    <span class="n">window</span><span class="o">=</span><span class="n">win</span><span class="p">,</span>
    <span class="n">keyboard</span><span class="o">=</span><span class="n">kb</span>
<span class="p">)</span><span class="o">.</span><span class="n">generate_conditions</span><span class="p">()</span> \
    <span class="o">.</span><span class="n">on_start</span><span class="p">(</span><span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="n">trigger_sender</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_onset&quot;</span><span class="p">)))</span> \
    <span class="o">.</span><span class="n">on_end</span><span class="p">(</span><span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="n">trigger_sender</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_end&quot;</span><span class="p">)))</span> \
    <span class="o">.</span><span class="n">run_trial</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">run_trial</span><span class="p">,</span> <span class="n">stim_bank</span><span class="o">=</span><span class="n">stim_bank</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="n">controller</span><span class="p">,</span> <span class="n">trigger_sender</span><span class="o">=</span><span class="n">trigger_sender</span><span class="p">))</span> \
    <span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>

<span class="n">ser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="example-parallel-lpt-port-not-tested-yet">
<h4>Example: Parallel (LPT) Port (Not tested yet)<a class="headerlink" href="#example-parallel-lpt-port-not-tested-yet" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">psychopy</span><span class="w"> </span><span class="kn">import</span> <span class="n">parallel</span><span class="p">,</span> <span class="n">logging</span><span class="p">,</span> <span class="n">core</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">psyflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">TriggerSender</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Adjust address to your system (e.g., &#39;0x0378&#39; on Windows)</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">parallel</span><span class="o">.</span><span class="n">ParallelPort</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s1">&#39;/dev/parport0&#39;</span><span class="p">)</span>
    <span class="n">send_code</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">port</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="n">trigger_sender</span> <span class="o">=</span> <span class="n">TriggerSender</span><span class="p">(</span><span class="n">trigger_func</span><span class="o">=</span><span class="n">send_code</span><span class="p">)</span>
    <span class="n">trigger_sender</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>  <span class="c1"># Sends 128 to the parallel port</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to initialize parallel port: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">Falling back to mock mode.&quot;</span><span class="p">)</span>
    <span class="n">trigger_sender</span> <span class="o">=</span> <span class="n">TriggerSender</span><span class="p">(</span><span class="n">mock</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">trigger_sender</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>  <span class="c1"># Prints to console instead</span>
</pre></div>
</div>
</section>
<section id="example-egi-netstation-not-tested-yet">
<h4>Example: EGI NetStation (Not tested yet)<a class="headerlink" href="#example-egi-netstation-not-tested-yet" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">egi_pynetstation.NetStation</span><span class="w"> </span><span class="kn">import</span> <span class="n">NetStation</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">psyflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">TriggerSender</span>

<span class="c1"># Configure IPs and port for your NetStation and amplifier</span>
<span class="n">IP_ns</span> <span class="o">=</span> <span class="s1">&#39;10.10.10.42&#39;</span>      <span class="c1"># NetStation host IP</span>
<span class="n">IP_amp</span> <span class="o">=</span> <span class="s1">&#39;10.10.10.51&#39;</span>     <span class="c1"># Amplifier NTP server IP (for 400-series amps)</span>
<span class="n">port_ns</span> <span class="o">=</span> <span class="mi">55513</span>            <span class="c1"># Default ECI port</span>

<span class="c1"># Initialize EGI NetStation client</span>
<span class="n">eci_client</span> <span class="o">=</span> <span class="n">NetStation</span><span class="p">(</span><span class="n">IP_ns</span><span class="p">,</span> <span class="n">port_ns</span><span class="p">)</span>
<span class="n">eci_client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">ntp_ip</span><span class="o">=</span><span class="n">IP_amp</span><span class="p">)</span>
<span class="n">eci_client</span><span class="o">.</span><span class="n">begin_rec</span><span class="p">()</span>

<span class="c1"># Wrap NetStation send_event in TriggerSender</span>
<span class="n">egi_sender</span> <span class="o">=</span> <span class="n">TriggerSender</span><span class="p">(</span>
    <span class="n">trigger_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="n">eci_client</span><span class="o">.</span><span class="n">send_event</span><span class="p">(</span>
        <span class="n">event_type</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">)[:</span><span class="mi">4</span><span class="p">],</span>  <span class="c1"># event_type max length 4 chars</span>
        <span class="n">start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>                  <span class="c1"># relative timestamp</span>
        <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="n">post_delay</span><span class="o">=</span><span class="mf">0.001</span>
<span class="p">)</span>

<span class="c1"># Send trigger code 100</span>
<span class="n">egi_sender</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># At experiment end, stop recording and disconnect</span>
<span class="n">eci_client</span><span class="o">.</span><span class="n">end_rec</span><span class="p">()</span>
<span class="n">eci_client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="example-neuroscan-via-parallel-port-not-tested-yet">
<h4>Example: Neuroscan via Parallel Port (Not tested yet)<a class="headerlink" href="#example-neuroscan-via-parallel-port-not-tested-yet" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">psychopy</span><span class="w"> </span><span class="kn">import</span> <span class="n">parallel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">psyflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">TriggerSender</span>

<span class="c1"># Initialize parallel port (address may vary by system)</span>
<span class="n">port</span> <span class="o">=</span> <span class="n">parallel</span><span class="o">.</span><span class="n">ParallelPort</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="mh">0x0378</span><span class="p">)</span>

<span class="c1"># Wrap parallel port setData in TriggerSender</span>
<span class="n">neuroscan_sender</span> <span class="o">=</span> <span class="n">TriggerSender</span><span class="p">(</span>
    <span class="n">trigger_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="p">[</span><span class="n">port</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="n">port</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span>  <span class="c1"># reset to 0 after send</span>
    <span class="n">post_delay</span><span class="o">=</span><span class="mf">0.001</span>
<span class="p">)</span>

<span class="c1"># Send code 50 to Neuroscan system</span>
<span class="n">neuroscan_sender</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="example-brain-products-via-rda-server-tcp-not-tested-yet">
<h4>Example: Brain Products via RDA Server (TCP) (Not tested yet)<a class="headerlink" href="#example-brain-products-via-rda-server-tcp-not-tested-yet" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">psyflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">TriggerSender</span>

<span class="c1"># Connect to BrainVision Recorder&#39;s RDA interface</span>
<span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">51244</span>
<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>

<span class="c1"># Wrap socket send in TriggerSender</span>
<span class="n">gp_sender</span> <span class="o">=</span> <span class="n">TriggerSender</span><span class="p">(</span>
    <span class="n">trigger_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">code</span><span class="si">}</span>
<span class="s1">&#39;.encode()),</span>
    <span class="n">post_delay</span><span class="o">=</span><span class="mf">0.001</span>
<span class="p">)</span>

<span class="c1"># Send marker 128 to Brain Products</span>
<span class="n">gp_sender</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>

<span class="c1"># Close socket when done</span>
<span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="advanced-timing-and-hooks">
<h3>3. Advanced: Timing and Hooks<a class="headerlink" href="#advanced-timing-and-hooks" title="Link to this heading">¶</a></h3>
<p>For finer control, <code class="docutils literal notranslate"><span class="pre">TriggerSender</span></code> lets you:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">post_delay</span></code>: Insert a pause (in seconds) after each send (default <code class="docutils literal notranslate"><span class="pre">0.001</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">on_trigger_start</span></code> : Call a function just before sending starts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">on_trigger_end</span></code> : Call a function after the post-delay.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">psyflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">TriggerSender</span>

<span class="k">def</span><span class="w"> </span><span class="nf">before_hook</span><span class="p">():</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trigger start at </span><span class="si">{</span><span class="n">t0</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">after_hook</span><span class="p">():</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trigger end at </span><span class="si">{</span><span class="n">t1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

<span class="n">trigger_sender</span> <span class="o">=</span> <span class="n">TriggerSender</span><span class="p">(</span>
    <span class="n">trigger_func</span><span class="o">=</span><span class="n">send_code</span><span class="p">,</span>
    <span class="n">post_delay</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">on_trigger_start</span><span class="o">=</span><span class="n">before_hook</span><span class="p">,</span>
    <span class="n">on_trigger_end</span><span class="o">=</span><span class="n">after_hook</span>
<span class="p">)</span>

<span class="n">trigger_sender</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<p>Use hooks to timestamp events, synchronize with other systems, or run custom diagnostics around each trigger.</p>
</section>
</section>
<hr class="docutils" />
<section id="integration-with-stimunit">
<h2>5. Integration with <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code><a class="headerlink" href="#integration-with-stimunit" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TriggerSender</span></code> can be passed into <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code> to automate sending triggers at key points in a trial with minimal code.</p>
<ol class="arabic">
<li><p><strong>Initialize and inject</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">psyflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">TriggerSender</span><span class="p">,</span> <span class="n">StimUnit</span>

<span class="n">sender</span> <span class="o">=</span> <span class="n">TriggerSender</span><span class="p">(</span><span class="n">trigger_func</span><span class="o">=</span><span class="n">your_send_func</span><span class="p">)</span>
<span class="n">unit</span> <span class="o">=</span> <span class="n">StimUnit</span><span class="p">(</span>
    <span class="n">unit_label</span><span class="o">=</span><span class="s1">&#39;trial1&#39;</span><span class="p">,</span>
    <span class="n">win</span><span class="o">=</span><span class="n">win</span><span class="p">,</span>
    <span class="n">kb</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span>
    <span class="n">triggersender</span><span class="o">=</span><span class="n">sender</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Automatic calls inside methods</strong>:</p>
<ul class="simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">.show()</span></code>, <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code> calls <code class="docutils literal notranslate"><span class="pre">sender.send(onset_trigger)</span></code> on the first frame (via <code class="docutils literal notranslate"><span class="pre">win.callOnFlip</span></code>) and <code class="docutils literal notranslate"><span class="pre">sender.send(offset_trigger)</span></code> after the visual presentation.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">.capture_response()</span></code>, it looks up the code for the pressed key and calls <code class="docutils literal notranslate"><span class="pre">sender.send(code)</span></code> immediately when the response is registered.</p></li>
</ul>
</li>
<li><p><strong>Configure trigger codes via dictionaries</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;onset&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;offset&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;response&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
<span class="p">}</span>

<span class="n">unit</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
    <span class="n">duration</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">onset_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="p">[</span><span class="s1">&#39;onset&#39;</span><span class="p">],</span>
    <span class="n">offset_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">unit</span><span class="o">.</span><span class="n">capture_response</span><span class="p">(</span>
    <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">],</span>
    <span class="n">duration</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="n">response_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>If you omit the <code class="docutils literal notranslate"><span class="pre">triggersender</span></code> or use <code class="docutils literal notranslate"><span class="pre">mock=True</span></code>, <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code> will still run all its hooks and logging, allowing you to develop and test behavioral tasks without hardware.</p>
<ol class="arabic simple" start="4">
<li><p><strong>Example: MID Task Integration</strong>:</p></li>
</ol>
<p>Below is a real-world example from a Monetary Incentive Delay (MID) task showing how to use <code class="docutils literal notranslate"><span class="pre">TriggerSender</span></code> and <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code> together. The <code class="docutils literal notranslate"><span class="pre">make_unit</span></code> helper simplifies passing the same <code class="docutils literal notranslate"><span class="pre">trigger_sender</span></code> to each trial phase.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">psyflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">StimUnit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_trial</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">stim_bank</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">trigger_sender</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run a single MID trial sequence (fixation → cue → anticipation → target → feedback).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trial_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="n">condition</span><span class="p">}</span>
    <span class="n">make_unit</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">StimUnit</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="n">win</span><span class="p">,</span> <span class="n">kb</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">triggersender</span><span class="o">=</span><span class="n">trigger_sender</span><span class="p">)</span>

    <span class="c1"># --- Cue Phase ---</span>
    <span class="n">make_unit</span><span class="p">(</span><span class="n">unit_label</span><span class="o">=</span><span class="s1">&#39;cue&#39;</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_cue&quot;</span><span class="p">))</span> \
        <span class="o">.</span><span class="n">show</span><span class="p">(</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">cue_duration</span><span class="p">,</span>
            <span class="n">onset_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_cue_onset&quot;</span><span class="p">)</span>
        <span class="p">)</span> \
        <span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">trial_data</span><span class="p">)</span>

    <span class="c1"># --- Anticipation Phase ---</span>
    <span class="n">anti</span> <span class="o">=</span> <span class="n">make_unit</span><span class="p">(</span><span class="n">unit_label</span><span class="o">=</span><span class="s1">&#39;anticipation&#39;</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fixation&quot;</span><span class="p">))</span>
    <span class="n">anti</span><span class="o">.</span><span class="n">capture_response</span><span class="p">(</span>
        <span class="n">keys</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">key_list</span><span class="p">,</span>
        <span class="n">duration</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">anticipation_duration</span><span class="p">,</span>
        <span class="n">onset_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_anti_onset&quot;</span><span class="p">),</span>
        <span class="n">terminate_on_response</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">early_resp</span> <span class="o">=</span> <span class="n">anti</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="s2">&quot;response&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">anti</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">early_response</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">early_resp</span><span class="p">))</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">trial_data</span><span class="p">)</span>

    <span class="c1"># --- Target Phase ---</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">get_duration</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
    <span class="n">tgt</span> <span class="o">=</span> <span class="n">make_unit</span><span class="p">(</span><span class="n">unit_label</span><span class="o">=</span><span class="s1">&#39;target&#39;</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_target&quot;</span><span class="p">))</span>
    <span class="n">tgt</span><span class="o">.</span><span class="n">capture_response</span><span class="p">(</span>
        <span class="n">keys</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">key_list</span><span class="p">,</span>
        <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
        <span class="n">onset_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_target_onset&quot;</span><span class="p">),</span>
        <span class="n">response_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_key_press&quot;</span><span class="p">),</span>
        <span class="n">timeout_trigger</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_no_response&quot;</span><span class="p">)</span>
    <span class="p">)</span>\
        <span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">trial_data</span><span class="p">)</span>

    <span class="c1"># --- Feedback Phase ---</span>
    <span class="n">feedback_code</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">triggers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="s1">&#39;hit&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">tgt</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="s1">&#39;hit&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">False</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;miss&#39;</span><span class="si">}</span><span class="s2">_fb_onset&quot;</span>
    <span class="p">)</span>
    <span class="n">make_unit</span><span class="p">(</span><span class="n">unit_label</span><span class="o">=</span><span class="s1">&#39;feedback&#39;</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">add_stim</span><span class="p">(</span><span class="n">stim_bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="s1">&#39;hit&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">tgt</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="s1">&#39;hit&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;miss&#39;</span><span class="si">}</span><span class="s2">_feedback&quot;</span><span class="p">))</span>\
        <span class="o">.</span><span class="n">show</span><span class="p">(</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">feedback_duration</span><span class="p">,</span>
            <span class="n">onset_trigger</span><span class="o">=</span><span class="n">feedback_code</span>
        <span class="p">)</span>\
        <span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">hit</span><span class="o">=</span><span class="n">tgt</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="s1">&#39;hit&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>\
        <span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">trial_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">trial_data</span>
</pre></div>
</div>
<p>This example demonstrates:</p>
<ul class="simple">
<li><p>Creating a partial constructor (<code class="docutils literal notranslate"><span class="pre">make_unit</span></code>) that automatically injects <code class="docutils literal notranslate"><span class="pre">trigger_sender</span></code> into each <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code>.</p></li>
<li><p>Scheduling onset and offset triggers for each phase with minimal boilerplate.</p></li>
<li><p>Seamlessly capturing responses and mapping them to trigger codes via <code class="docutils literal notranslate"><span class="pre">settings.triggers</span></code>.</p></li>
</ul>
<p>If you choose not to pass a <code class="docutils literal notranslate"><span class="pre">triggersender</span></code>, the exact same code will run as a behavioral-only task, emitting logs but without hardware triggers.</p>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">¶</a></h2>
<p>Now that you know how to send triggers, you can explore other parts of PsyFlow:</p>
<ul class="simple">
<li><p><strong>Getting Started</strong>: If you’re new to PsyFlow, check out the <a class="reference internal" href="getting_started.html"><span class="std std-doc">Getting Started tutorial</span></a>.</p></li>
<li><p><strong>Building Trials</strong>: Learn how to build complex trials in the <a class="reference internal" href="build_stimunit.html"><span class="std std-doc">StimUnit tutorial</span></a>.</p></li>
<li><p><strong>Organizing Blocks</strong>: See the <a class="reference internal" href="build_blocks.html"><span class="std std-doc">BlockUnit tutorial</span></a> to learn how to organize trials into blocks.</p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="cli_usage.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">psyflow-init: Command-Line Interface</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="build_stimunit.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">StimUnit: Modular Stimulus &amp; Response Handler</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Zhipeng Cao
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">TriggerSender: Sending Hardware Triggers</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#key-features">Key Features</a></li>
<li><a class="reference internal" href="#quick-reference">Quick Reference</a></li>
<li><a class="reference internal" href="#detailed-usage-guide">Detailed Usage Guide</a><ul>
<li><a class="reference internal" href="#getting-started-mock-mode-for-development">1. Getting Started: Mock Mode for Development</a></li>
<li><a class="reference internal" href="#connecting-to-real-hardware">2. Connecting to Real Hardware</a><ul>
<li><a class="reference internal" href="#example-serial-uart-port-tested">Example: Serial (UART) Port (tested)</a></li>
<li><a class="reference internal" href="#example-parallel-lpt-port-not-tested-yet">Example: Parallel (LPT) Port (Not tested yet)</a></li>
<li><a class="reference internal" href="#example-egi-netstation-not-tested-yet">Example: EGI NetStation (Not tested yet)</a></li>
<li><a class="reference internal" href="#example-neuroscan-via-parallel-port-not-tested-yet">Example: Neuroscan via Parallel Port (Not tested yet)</a></li>
<li><a class="reference internal" href="#example-brain-products-via-rda-server-tcp-not-tested-yet">Example: Brain Products via RDA Server (TCP) (Not tested yet)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-timing-and-hooks">3. Advanced: Timing and Hooks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#integration-with-stimunit">5. Integration with <code class="docutils literal notranslate"><span class="pre">StimUnit</span></code></a></li>
<li><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=a58bc63e"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>